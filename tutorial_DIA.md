## Building spectral libraries for DIA analysis

##### [FragPipe](https://fragpipe.nesvilab.org) can be downloaded [here](https://github.com/Nesvilab/FragPipe/releases). Follow the instructions on that same Releases page to launch the program. See [here](https://msfragger.nesvilab.org/tutorial_fragpipe.html#configure-fragpipe) for help configuring FragPipe.

FragPipe has several options for analyzing DIA data with spectral libraries:

https://msfragger.nesvilab.org/tutorial_fragpipe.html#configure-fragpipe
* [Build a library from DDA data](https://msfragger.nesvilab.org/tutorial_DIA.html#build-a-library-from-dda-data)
* [Build a library from DIA data (direct DIA using DIA-Umpire)](https://msfragger.nesvilab.org/tutorial_DIA.html#build-a-library-from-dia-data)
* [Build a library from combined DDA and DIA data](https://msfragger.nesvilab.org/tutorial_DIA.html#build-a-library-from-combined-dda-and-dia-data)

We recommend [using DIA-NN for quantification](https://msfragger.nesvilab.org/tutorial_DIA.html#quantification-with-dia-nn).
<br>
<br>

### Build a spectral library from DDA data
1. Select the 'SpecLib' workflow from the dropdown menu and 'Load'.
2. Load DDA spectral files in mzML or RAW format. (In this example, 6 DDA fractions were loaded.)
3. In the 'Database' tab, download or select an existing database. (In this case, a mouse database was downloaded with reviewed sequences, decoys, common contaminants, and iRT peptides. [UPS protein sequences] were also added manually.)

**Note**: If you're working with a non-human dataset, change the 'RT calibration' option on the 'Spec Lib' tab to 'iRT' if these peptides have been spiked-in. EasyPQP will use the ciRT option (Biognosys common HeLa peptides) by default.

4. On the 'Run' tab, choose the location to output the results and click 'RUN'.

![](https://raw.githubusercontent.com/Nesvilab/MSFragger/master/images/DIA-tutorial_DDALibOnly.png)
<br>


### Build a spectral library from DIA data
1. Select the 'DIA-Umpire_SpecLib' workflow from the dropdown menu and 'Load'.
2. Load DIA spectral files in mzML or RAW format. (In this example, 10 DIA runs were loaded.)
3. On the 'Umpire' tab, choose the appropriate settings:
 - Change 'Max Missed Scans' to 2 if building a library from DDA data only (slower run time but higher identification sensitivity).
 - Check 'Remove Background' if building a hybrid DDA+DIA library and if there are many DIA runs (fastest run time).
 - Uncheck 'Mass Defect Filter' if DIA data is generated on modification-enriched peptides (e.g. phospho), or if you're interested in extended PTM searches.
4. In the 'Database' tab, download or select an existing sequence database.
5. On the 'Run' tab, choose the location to output the results and click 'RUN'.

![](https://raw.githubusercontent.com/Nesvilab/MSFragger/master/images/DIA-tutorial_DIAUmpireLib.png)
<br>


### Build a spectral library from combined DDA and DIA data
This workflow is composed of two steps:

A) extract pseudo-MS/MS spectra from DIA data using DIA-Umpire, and

B) build the library from the pseudo-MS/MS DDA files and additional DDA files**

1. For part A, load the 'DIA_Umpire' workflow, add DIA mzML files, and adjust the DIA-Umpire parameters as needed (see above). Select the output destination and 'RUN'. When DIA-Umpire is finished, the output folder will contain three pseudo-MS/MS (pseudo-DDA) files for each input mzML, with the suffixes `_Q1.mzML`, `_Q2.mzML`, `_Q3.mzML`.
 
2. For part B (shown below), first load the 'SpecLib' workflow.
3. Clear the DIA files from part A.
4. Load DDA mzML files and also all pseudo-MS/MS mzML files generated by part A.
5. On the 'Run' tab, click 'RUN'.

![](https://raw.githubusercontent.com/Nesvilab/MSFragger/master/images/DIA-tutorial_CombinedLib.png)
<br>

### Quantify with DIA-NN
1. Click 'Raw' and load mzML files (or RAW format if DIA-NN has been configured to read the RAW format).
2. Select the spectral library generated using FragPipe ('library.tsv' file).
3. Choose where to write the output and the file name (e.g. 'DIA-NN_DIALib.tsv').
4. Specify the number of threads to use.
5. Set 'Protein inference' to 'Off', and 'Quantification strategy' to 'Robust LC (high accuracy)' (recommended). In the FragPipe-generated spectral library, shared peptides are assigned to proteins with the most evidence (razor proteins).
6. Click 'Run'.

![](https://raw.githubusercontent.com/Nesvilab/MSFragger/master/images/DIA-tutorial_DIANN.png)
<br>
<br>
#### [Back to FragPipe homepage](https://fragpipe.nesvilab.org/)












